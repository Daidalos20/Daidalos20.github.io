const item_containers = {
  RTW: {
    meta: {
      display_name: 'RTW Inhalt',
    },
    items: [
      {
        name: 'Defibrillator',
        location: 'Fahrzeug 1, Fach A',
      },
      {
        name: 'Sauerstoffflasche',
        location: 'Fahrzeug 2, Fach B',
      },
      {
        name: 'Erste-Hilfe-Kasten',
        location: 'Wache 1, Regal 3',
      },
      {
        name: 'Trage',
        location: 'Fahrzeug 1, Fach C',
      },
      {
        name: 'Feuerlöscher',
        location: 'Fahrzeug 2, Fach D',
      },
      {
        name: 'Medizinische Handschuhe',
        location: 'Wache 1, Schrank 2',
      },
      {
        name: 'Atemschutzmaske',
        location: 'Fahrzeug 1, Fach E',
      },
    ],
  },
  NEF: {
    meta: {
      display_name: 'NEF Inhalt',
    },
    items: [
      {
        name: 'Medizinische Handschuhe',
        location: 'Wache 1, Schrank 2',
      },
      {
        name: 'Atemschutzmaske',
        location: 'Fahrzeug 1, Fach E',
      },
    ],
  },
  NEF2: {
    meta: {
      display_name: 'NEF2 Inhalt',
    },
    items: [
      {
        name: 'Medizinische Handschuhe',
        location: 'Wache 1, Schrank 2',
      },
      {
        name: 'Atemschutzmaske',
        location: 'Fahrzeug 1, Fach E',
      },
    ],
  },
  NEF5: {
    meta: {
      display_name: 'NEF 5 Inhalt',
    },
    items: [
      {
        name: 'Medizinische Handschuhe',
      },
      {
        name: 'Atemschutzmaske',
        location: 'Fahrzeug 1, Fach E',
      },
    ],
  },

  'SSD-Rucksack': {
    meta: {
      display_name: 'SSD Rucksack',
    },
    items: [
      {
        name: 'Kindermaske (Hellblau)',
        location: 'Tasche Beatmung (Blau)',
      },
      {
        name: 'Babymaske (Schwarz)',
        location: 'Tasche Beatmung (Blau)',
      },
      {
        name: 'Hyperventilationsmaske',
        location: 'Tasche Beatmung (Blau)',
      },
      {
        name: 'G\u00fcdeltubus',
        location: 'Tasche Beatmung (Blau)',
      },
      {
        name: 'Einmal Beatmungstuch',
        location: 'Tasche Beatmung (Blau)',
      },
      {
        name: 'Absaugpumpe',
        location: 'Tasche Beatmung (Blau)',
      },
      {
        name: 'Thermomether mit Schutzkappe',
        location: 'Tasche Diagnostik (Rot)',
      },
      {
        name: 'Pulsoximeter',
        location: 'Tasche Diagnostik (Rot)',
      },
      {
        name: 'Blutdruckmanchette',
        location: 'Tasche Diagnostik (Rot)',
      },
      {
        name: 'Stethoskop',
        location: 'Tasche Diagnostik (Rot)',
      },
      {
        name: '\u22656 Sterile Kompressen',
        location: 'Tasche Verband (Gr\u00fcn)',
      },
      {
        name: '1 Verbandtuch -A',
        location: 'Tasche Verband (Gr\u00fcn)',
      },
      {
        name: '1 Verbandtuch -B oder -BR',
        location: 'Tasche Verband (Gr\u00fcn)',
      },
      {
        name: '2 Verbandp\u00e4cken klein',
        location: 'Tasche Verband (Gr\u00fcn)',
      },
      {
        name: '4 Verbandp\u00e4ckchen Mittel',
        location: 'Tasche Verband (Gr\u00fcn)',
      },
      {
        name: '2 Verbandp\u00e4cken Gro\u00df',
        location: 'Tasche Verband (Gr\u00fcn)',
      },
      {
        name: '4 Hautreinigungstuch',
        location: 'Tasche Verband (Gr\u00fcn)',
      },
      {
        name: '2 Dreiecktuch',
        location: 'Tasche Verband (Gr\u00fcn)',
      },
      {
        name: '3 Fixierbinden 8cm',
        location: 'Tasche Verband (Gr\u00fcn)',
      },
      {
        name: '3 Fixierbinden 6cm',
        location: 'Tasche Verband (Gr\u00fcn)',
      },
      {
        name: 'Netzverband f\u00fcr Extremit\u00e4ten',
        location: 'Tasche Verband (Gr\u00fcn)',
      },
      {
        name: '2 Augenkompressen',
        location: 'Tasche Verband (Gr\u00fcn)',
      },
      {
        name: '1 Pflasterrolle',
        location: 'Tasche Verband (Gr\u00fcn)',
      },
      {
        name: '2 Coolpacks Gro\u00df "Midi"',
        location: 'Tasche Coolpacks (Gelb)',
      },
      {
        name: '2 Coolpacks Klein "Mini"',
        location: 'Tasche Coolpacks (Gelb)',
      },
      {
        name: '2 Mullbinden',
        location: 'Tasche Schienen (Gelb)',
      },
      {
        name: '1 Pflasterrolle',
        location: 'Tasche Schienen (Gelb)',
      },
      {
        name: '1 Samsplint',
        location: 'Tasche Schienen (Gelb)',
      },
      {
        name: 'Handdesinfektionsmittel',
        location: 'Gro\u00dfes Fach',
      },
      {
        name: 'Einweisungsweste',
        location: 'Gro\u00dfes Fach',
      },
      {
        name: '\u22654 Sicsac (Brechbeutel mit Plastikrand)',
        location: 'Gro\u00dfes Fach',
      },
      {
        name: 'Stifneck',
        location: 'Gro\u00dfes Fach',
      },
      {
        name: 'Beatmugsbeutel + Maske',
        location: 'Gro\u00dfes Fach',
      },
      {
        name: '2 Replantat-/Folienbeutel',
        location: 'Gro\u00dfes Fach',
      },
      {
        name: 'Augensp\u00fchlung',
        location: 'Gro\u00dfes Fach',
      },
      {
        name: 'Umbettungstuch als Tragetuch',
        location: 'Deckel Oben: Gro\u00dfes Fach Hinten',
      },
      {
        name: '4 Paar Einamlhandschhe M',
        location: 'Deckel Oben: Laschen',
      },
      {
        name: '\u22655 RTW Protolkolle',
        location: 'Deckel Mitte: Fach Hinten',
      },
      {
        name: '\u226510 kleine Protokolle',
        location: 'Deckel Mitte: Fach Hinten',
      },
      {
        name: 'Merkhilfe Notruf',
        location: 'Deckel Mitte: Fach Hinten',
      },
      {
        name: 'Geb\u00e4udeplan',
        location: 'Deckel Mitte: Fach Hinten',
      },
      {
        name: '2 PPF2 Masken',
        location: 'Deckel Mitte: Fach Hinten',
      },
      {
        name: 'Pupillenlampe',
        location: 'Deckel Mitte: Laschen',
      },
      {
        name: '(Kleider-) Schere',
        location: 'Deckel Mitte: Laschen',
      },
      {
        name: '4 Verbandp\u00e4ckchen Mittel',
        location: 'Deckel Mitte: Laschen',
      },
      {
        name: '2 Gold-Silber Folien',
        location: 'Deckel Unten Links: Hinteres Fach',
      },
      {
        name: '5 Vliesstoff-Tuch',
        location: 'Deckel Unten Links: Hinteres Fach',
      },
      {
        name: '2 Kullis',
        location: 'Deckel Unten Links: Hinteres Stift-Halter',
      },
      {
        name: 'Kleine Schere',
        location: 'Deckel Unten Links: Hinteres Stift-Halter',
      },
      {
        name: 'Splitter-Pinzette',
        location: 'Deckel Unten Links: Hinteres Stift-Halter',
      },
      {
        name: 'Zeckenzange',
        location: 'Deckel Unten Links: Hinteres Stift-Halter',
      },
      {
        name: 'Pflasterset (inhalt siehe unten',
        location: 'Deckel Unten Rechts: Hinteres Fach',
      },
      {
        name: '6 Pflasterstrips 7,2 x 1,9 cm',
        location: 'Deckel Unten Rechts: Hinteres Fach',
      },
      {
        name: '12 Pflasterstrips 7,2 x 2,5 cm',
        location: 'Deckel Unten Rechts: Hinteres Fach',
      },
      {
        name: '6 Fingerverband 12 x 2 cm',
        location: 'Deckel Unten Rechts: Hinteres Fach',
      },
      {
        name: '6 Fingerkuppenpflaster 8 x 4,5 cm',
        location: 'Deckel Unten Rechts: Hinteres Fach',
      },
      {
        name: '12 Wundschnellverband 10 x 6 cm',
        location: 'Deckel Unten Rechts: Hinteres Fach',
      },
      {
        name: '\u22654 Traubenzucker',
        location: 'Deckel Unten Rechts: Durchsichtiges Fach',
      },
      {
        name: 'Zeckenkarte',
        location: 'Deckel Unten Rechts: Durchsichtiges Fach',
      },
      {
        name: '2 Paar Einmalhandschuhe S',
        location: 'Deckel Unten Rechts: Durchsichtiges Fach',
      },
      {
        name: '2 Paar Einmalhandschuhe L',
        location: 'Deckel Unten Rechts: Durchsichtiges Fach',
      },
    ],
  },

  'TSF-W': {
    meta: {
      display_name: 'TSF-W Orsenhausen',
    },
    items: [
      {
        name: 'Moters\u00e4ge',
        location: 'G3(mitte mitte);1',
      },
      {
        name: 'Ersatzkette f\u00fcr Motors\u00e4ge',
        location: 'G3(mitte mitte);2',
      },
      {
        name: 'Schnittschutzhose',
        location: 'GH(rechts neben Spinde);2',
      },
      {
        name: 'Motors\u00e4genhelm',
        location: 'G3(mitte mitte);1',
      },
      {
        name: 'F\u00e4ll- und Spaltkeile',
        location: 'G3(mitte mitte);4',
      },
      {
        name: 'Doppelkanister mit Motors\u00e4genkraftstoff und Ketten\u00f6l',
        location: 'G3(oben mitte);1',
      },
      {
        name: 'Stromerzeuger',
        location: 'G2(unten rechts);1',
      },
      {
        name: 'Kanister f\u00fcr Stromerzeuger',
        location: 'G2(unten links);1',
      },
      {
        name: 'Leitungsroller 50m',
        location: 'G2(mitte rechts);1',
      },
      {
        name: 'Flutlichtstrahler',
        location: 'G2(mitte mittte);2',
      },
      {
        name: 'Stativ f\u00fcr Flutlichtstrahler',
        location: 'G2(mitte mitte);1',
      },
      {
        name: 'Schaumaufsatz C-Hohlstrahlrohr',
        location: 'G1(unten links, zw. Halligan und Axt);1',
      },
      {
        name: 'Zumischer Z2R',
        location: 'G4(mitte leicht links, festeingebaut);1',
      },
      {
        name: 'Ansaugschlauch D (f\u00fcr Zumischer)',
        location: 'G4(mitte mitte, \u00fcber Schaumkanister);1',
      },
      {
        name: 'Schaummittelbeh\u00e4lter',
        location: 'G4(unten mitte);1',
      },
      {
        name: 'Ansaugreduzierung f\u00fcr Zumischer',
        location: 'G4(am Zumischer angesteckt);1',
      },
      {
        name: 'Hohlsteiner Schaufel',
        location: 'G1(oben mitte);1',
      },
      {
        name: 'F\u00e4llheber',
        location: 'G1(unten links)1;1',
      },
      {
        name: 'Rauchvorhang',
        location: 'G1(am l. Schlauchtragekorb);1',
      },
      {
        name: 'Druckbel\u00fcfter',
        location: 'G3(unten links);1',
      },
      {
        name: 'Tauchpumpe',
        location: 'G3(unten mitte);1',
      },
      {
        name: 'Lichtmast',
        location: 'auf dem Dach (Fernbedienung in GR)',
      },
      {
        name: 'Euro-Blitz',
        location: 'G4(unten mitte);2',
      },
      {
        name: 'Absperrhahn C',
        location: 'G4(mitte links, von unten angekuppelt);1',
      },
      {
        name: 'Faltsignal',
        location: 'G2(oben mitte);2',
      },
      {
        name: 'Bockleiterteil Steckleitern',
        location: 'G2(oben rechts);1',
      },
      {
        name: 'Flatterbandroller',
        location: 'G2(unten links);1',
      },
      {
        name: 'Bandschlinge 2m',
        location: 'G4 bei den PAs/GR bei den PAs;insg. 2',
      },
      {
        name: 'W\u00e4rmebildkamera',
        location: 'MR(R\u00fcckwand);1',
      },
      {
        name: 'AED',
        location: 'MR;1',
      },
      {
        name: 'Pack Hygiene Handschuhe',
        location: 'MR;1',
      },
      {
        name: 'Wagenheber',
        location: 'Bank;1',
      },
      {
        name: 'L\u00f6schdecke',
        location: 'MR;1',
      },
      {
        name: 'Bauplane 2qm',
        location: 'Bank;1',
      },
      {
        name: 'Rohrzange',
        location: 'Bank;1',
      },
      {
        name: 'Druckluft "Pistole"',
        location: 'Bank;1',
      },
      {
        name: 'Corona Kit (Schutzbrille+Hygienehandschuhe)',
        location: 'Bank;1',
      },
      {
        name: 'GF Weste',
        location: 'GF Sitz im FR;1',
      },
      {
        name: 'EL Weste',
        location: 'FR',
      },
      {
        name: 'diverse Einsatzpl\u00e4ne/Karten',
        location: 'Mittelfach FR',
      },
      {
        name: 'Warnweste',
        location: 'in den T\u00fcren im MR; 9',
      },
      {
        name: 'PA',
        location: 'MR, G4(unten rechts); insg. 4',
      },
      {
        name: 'Atemschutzmaske',
        location: 'MR, G4(unten rechts hinten); insg. 4',
      },
      {
        name: 'ABEK Filter',
        location: 'Bank;4',
      },
      {
        name: 'Atemschutz\u00fcberwachung',
        location: 'G4(unten rechts, rechts neben PAs);1',
      },
      {
        name: 'Fluchthaube',
        location: 'Bank;1',
      },
      {
        name: 'K\u00fcbelspritze',
        location: 'G3(unten rechts);1',
      },
      {
        name: 'ABC Pulverl\u00f6scher',
        location: 'G3(unten Rechts);1',
      },
      {
        name: 'Druckschl\u00e4uche B 20m',
        location:
          'G4(oben mitte)+G4(unten links am Schnellangriffsverteiler);9+1=10',
      },
      {
        name: '5m B-Schlauch',
        location: 'G4(oben ganz links);1',
      },
      {
        name: 'Tragek\u00f6rbe mit C-Schlauch 15m',
        location: 'G1(mitte rechts);3*3=9',
      },
      {
        name: 'Schnellangriffschlauch C 15m + Hohlstrahlrohr',
        location: 'G4(unten links);1',
      },
      {
        name: 'Saugschlauch A',
        location: 'G1(mitte links);4',
      },
      {
        name: 'Saugkorb A',
        location: 'G3(oben rechts);1',
      },
      {
        name: 'Saugschutzkorb (Draht)',
        location: 'G3(oben rechts);1',
      },
      {
        name: 'Standrohr DIN',
        location: 'G3(oben links);1',
      },
      {
        name: 'Standrohr W\u00fcrtembergisch',
        location: 'G4(oben rechts);1',
      },
      {
        name: 'Sammelst\u00fcck A-2B',
        location: 'G4(mitte links);1',
      },
      {
        name: 'Verteiler',
        location: 'G4(unten links);1',
      },
      {
        name: 'BC-\u00dcbergangsst\u00fcck',
        location: 'G4(mitte links, von unten angsbracht);2',
      },
      {
        name: 'B-Mehrzweckstrahlrohr mit St\u00fczukr\u00fcmmer',
        location: 'G4(mitte mitte);1',
      },
      {
        name: 'Hohlstrahlrohr C',
        location: 'G1(mitte mitte, von unten eingeh\u00e4ngt);3',
      },
      {
        name: 'Mehrzweckleine (Rot)',
        location: 'G3(oben rechts);1',
      },
      {
        name: 'Seilschlauchhalter (Seilst\u00fccke)',
        location: 'MR bei PA+ G4 bei PA; 1+2=3',
      },
      {
        name: 'Schlauchbr\u00fccke',
        location: 'G1(unten);3',
      },
      {
        name: 'Kupplungsschl\u00fcssel ABC f\u00fcr ua. B-Schl\u00e4uche (Metall mit schwarzem Griff)',
        location: 'GR(unten links);3',
      },
      {
        name: 'Schl\u00fcssel B f\u00fcr \u00dcberfluhrhydrant (rot)',
        location: 'G4(links neben/hinter PAs);1',
      },
      {
        name: 'Schl\u00fcssel C f\u00fcr Unterflurhydrant Norm',
        location: 'G3(oben links);1',
      },
      {
        name: 'Schl\u00fcssel C f\u00fcr Unterflurhydrant W\u00fcrtembergisch',
        location: 'G4(oben rechst);1',
      },
      {
        name: 'Paar Schachthaken mit Kette',
        location:
          'G3(mitte rechts, von Rechts ans Blech befestigt, \u00fcberm Feuerl\u00f6scher);1',
      },
      {
        name: 'Standrohrhalter',
        location: 'G4(oben rechts);1',
      },
      {
        name: 'Steckleiter 4Teilig + Einsteckteil',
        location: 'GR(oben);1',
      },
      {
        name: 'Feuerwehrleine im Tragebeutel',
        location: 'MR, G4 (bei/hinter PAs); gefordert:4',
      },
      {
        name: 'Notfallrucksack',
        location: 'MR;1',
      },
      {
        name: 'Schleifkorbtrage',
        location: 'G3(oben mitte);1',
      },
      {
        name: 'Wolldecke',
        location: 'Bank;1',
      },
      {
        name: 'Tragetuch mit Tasche',
        location: 'Bank;1',
      },
      {
        name: 'Taschenlampen',
        location: 'MR+FR; 3+1?',
      },
      {
        name: 'Warnleuchte StVZO',
        location: 'MR;2',
      },
      {
        name: 'Winkerkelle',
        location: 'MR;2',
      },
      {
        name: 'Pylonen',
        location: 'G2(oben links);4',
      },
      {
        name: 'Handspreckfunkger\u00e4te',
        location: 'MR+FR;3+1',
      },
      {
        name: 'Mulde Stahl',
        location: 'G3(mitte rechts);1',
      },
      {
        name: 'Tragkraftspritze PFPN 10-1000',
        location: 'GR;1',
      },
      {
        name: 'Werkzeugkasten',
        location: 'G1(oben rechts);1',
      },
      {
        name: 'Halligan-Tool',
        location: 'G1(unten links unter den Saugschl\u00e4uchen);1',
      },
      {
        name: 'Spalthammer',
        location: 'G1(unten mitte);1',
      },
      {
        name: 'Feuerwehraxt (mit Spitze auf Gegenseite)',
        location: 'G1(unten mitte);1',
      },
      {
        name: 'Holzaxt (flat axe)',
        location: 'G1(unten mitte);1',
      },
      {
        name: 'B\u00fcgels\u00e4ge',
        location: 'G1(unten links unter Saugschl\u00e4uche);1',
      },
      {
        name: 'Bolzenschneider',
        location: 'G1(mitte mitte, links von Strahlrohren);1',
      },
      {
        name: 'Stechschaufel',
        location: 'G1(oben mitte);1',
      },
      {
        name: 'Sto\u00dfbesen',
        location: 'G1(oben mitte);2',
      },
      {
        name: 'Unterlegkeil',
        location: 'G1(unten links);2',
      },
      {
        name: 'Abschleppseil f\u00fcr 3,5t, 5m lang',
        location: 'G2(mitte links);1',
      },
      {
        name: '\u00d6lbinder in Kunststofffass',
        location: 'G2(oben mitte);1',
      },
      {
        name: 'Kraftstoffkanister TS',
        location:
          'G3(unten rechts, zw. Feuerl\u00f6scher und K\u00fcbelspritze)',
      },
    ],
  },
};
let items_left = [];
var current_container_name;
let results = [];
const mainButtonElement = document.getElementById('next_stop_button');
const itemElement = document.getElementById('item');
let current_item = undefined;
// TIMIER NEW
let timer_time = 0;
let intervalId = null;
let timer_running = false;

function startTimer() {
  document.querySelector('.item-container').classList.add('timer-active');
  timer_running = true;
  timer_time = 0;
  let startTime = Date.now();
  intervalId = setInterval(() => {
    timer_time = (Date.now() - startTime) / 1000;
    updateTimerDisplay();
  }, 10); // update every 10ms
}

function stopTimer() {  
  document.querySelector('.item-container').classList.remove('timer-active');
  if (timer_running) {
    timer_running = false;
    clearInterval(intervalId);
    intervalId = null;
  }
}

function resetTimer() {
  stopTimer();
  timer_time = 0;
  updateTimerDisplay();
}

function updateTimerDisplay() {
  let timerElement = document.getElementById('timer');
  timerElement.textContent = `Zeit: ${timer_time.toFixed(2)}s`;
}

// NAV OVERLAY
function showNav() {
  document.querySelector('.nav-icon').classList.add('active');
  const navOverlay = document.querySelector('.nav-overlay');
  navOverlay.classList.add('show');
  navOverlay.style.animation = 'slideIn 0.5s forwards';
}

function hideNav() {
  const navOverlay = document.querySelector('.nav-overlay');
  if (navOverlay.classList.contains('show')) {
    document.querySelector('.nav-icon').classList.remove('active');
    navOverlay.classList.remove('show');
    navOverlay.style.animation = 'slideOut 0.5s forwards';
  }
}

function toggleNav() {
  const navOverlay = document.querySelector('.nav-overlay');

  if (navOverlay.classList.contains('show')) {
    hideNav();
  } else {
    showNav();
  }
}

const navOverlay = document.querySelector('.nav-overlay');

let navOverlayButtons = [];

function loadNavOverlay() {
  Object.keys(item_containers).forEach(key => {
    const button = document.createElement('button');
    button.id = key;
    button.textContent = item_containers[key]['meta']['display_name'];
    button.onclick = function () {
      startNewRound(this.id);
    };
    navOverlayButtons.push(button); // store the buttons in an array
    navOverlay.appendChild(button);
  });

  updateHighlighting(); // call the updateHighlighting function initially to set the highlighting
}

function updateHighlighting() {
  // remove the highlighted class from all buttons
  navOverlayButtons.forEach(button => {
    button.classList.remove('highlighted');
  });

  // add the highlighted class to the button with the matching id
  const highlightedButton = document.getElementById(current_container_name);
  if (highlightedButton) {
    highlightedButton.classList.add('highlighted');
  }
}

function startNewRound(container_name) {
  hideLocationHint();
  loadContainer(container_name);
  updateProgressBar();
  mainButtonElement.innerHTML = `Neue Runde mit <b>${item_containers[container_name]['meta']['display_name']}</b> starten!</br>Alternativ oben rechts bei ☰ einen andern Ort beüben.`;
  itemElement.innerHTML = 'Hier wird der gesuchte Gegenstand angezeigt.';
  updateHighlighting();
  hideNav();
  resetTimer();
  
}

function loadContainer(container_name) {
  items_left = shuffleList(item_containers[container_name]['items']);
  current_container_name = container_name;
  current_item = undefined;
  results = [];
}

function shuffleList(list) {
  // Create a copy of the original list to avoid modifying it
  const shuffledList = [...list];
  // Use the Fisher-Yates shuffle algorithm to shuffle the list
  for (let i = shuffledList.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffledList[i], shuffledList[j]] = [shuffledList[j], shuffledList[i]];
  }
  return shuffledList;
}

// RESULT MODAL

function showResultModal(results) {
  fillGeneralResults(results);
  fillResultTable(results);
  document.getElementById('result-modal').classList.add('show');
  document.body.classList.add('overlay-open');
}

function fillGeneralResults(results) {
  total_time = Math.floor(results.reduce((acc, obj) => acc + obj.time, 0));
  const minutes = Math.floor(total_time / 60);
  const remainingSeconds = total_time % 60;
  const timeString = `Gesmmtdauer <b>${minutes}:${remainingSeconds.toString().padStart(2, '0')}</b> Minuten`;
  const generalResultsElement = document.getElementById('general-results');
  generalResultsElement.innerHTML = timeString;
}

function fillResultTable(data) {
  data = sortByTimeDescAndHintNeeded(data);
  const tableElement = document.getElementById('result-table');
  tableElement.innerHTML = '';
  const headers = ['Zeit', 'Gegenstand', 'Hinweis Benötigt'];
  const rows = [];
  // Create table headers
  const headerRow = document.createElement('tr');
  headers.forEach(header => {
    const th = document.createElement('th');
    th.textContent = header;
    headerRow.appendChild(th);
  });
  tableElement.appendChild(headerRow);
  // Create table rows
  data.forEach(item => {
    const row = document.createElement('tr');
    if (item.hint_needed) {
      row.style.backgroundColor = '#8B0A1A'; // dark red shade
    }
    row.innerHTML = `
      <td>${item.time.toFixed(2)}</td>
      <td>${item.itemName}</td>
      <td>${item.hint_needed ? 'Ja' : 'Nein'}</td>
    `;
    tableElement.appendChild(row);
  });
}

function sortByTimeDescAndHintNeeded(results) {
  return results.sort((a, b) => {
    if (a.hint_needed !== b.hint_needed) {
      return a.hint_needed ? -1 : 1;
    } else {
      return b.time - a.time;
    }
  });
}

function closeResultModal() {
  document.getElementById('result-modal').classList.remove('show');
  document.body.classList.remove('overlay-open');
  startNewRound(current_container_name)
}

document.querySelector('.close-btn').addEventListener('click', closeResultModal);

//Main button
function mainButtonClicked() {
  if (!timer_running) {
    showNewItem();
  } else {
    handleItemFound();
  }
}

function showNewItem() {
  hideLocationHint();
  current_item = items_left.pop();
  current_item.hint_needed = false;
  const itemElement = document.getElementById('item');
  itemElement.innerHTML = current_item.name
  const locationHintElement = document.getElementById('location-hint');
  if(!current_item.location){
    current_item.location = "? nicht Eingetragen ?"
  }
  locationHintElement.innerHTML = current_item.location;
  mainButtonElement.innerHTML = 'Gefunden!';
  startTimer();
}

function handleItemFound() {
  stopTimer();
  updateProgressBar();
  saveResult()
  mainButtonElement.innerHTML = 'Nächster Gegenstand';
  if (items_left.length === 0) {
    showResultModal(results);
  }
}

function saveResult(){
  const currentItemResult = {
    itemName: current_item.name,
    time: timer_time,
    hint_needed: current_item.hint_needed
  };
  results.push(currentItemResult);
}

function updateProgressBar() {
  const progressBarElement = document.getElementById('progress-bar');
  const progressTextElement = document.getElementById('progress-text');
  const items_done =
        item_containers[current_container_name]['items'].length - items_left.length;
  const progress =
        (items_done / item_containers[current_container_name]['items'].length) *
        100;
  progressBarElement.style.width = `${progress}%`;
  progressTextElement.textContent = `${items_done} von ${item_containers[current_container_name]['items'].length}`;
}

function showLocationHint() {
  if (timer_running) {
    current_item.hint_needed = true;
  }
  document.getElementById('location-hint').style.display = 'block';
}

function hideLocationHint() {
  document.getElementById('location-hint').style.display = 'none';
}

//initial load
startNewRound('RTW');
loadNavOverlay();

// testing: 
